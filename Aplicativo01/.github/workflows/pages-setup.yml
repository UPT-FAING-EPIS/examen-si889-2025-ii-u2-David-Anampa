name: Setup GitHub Pages

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  setup-pages:
    name: Configure Pages
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Pages
        uses: actions/configure-pages@v3
      
      - name: Create index page
        run: |
          mkdir -p public
          cat > public/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="es">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Reportes del Proyecto</title>
              <style>
                  body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
                  .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                  h1 { color: #333; border-bottom: 3px solid #007acc; padding-bottom: 10px; }
                  .report-link { display: block; padding: 15px; margin: 10px 0; background: #007acc; color: white; text-decoration: none; border-radius: 5px; transition: background 0.3s; }
                  .report-link:hover { background: #005a9e; }
                  .info { background: #e7f3ff; padding: 15px; border-left: 4px solid #007acc; margin: 20px 0; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>Reportes del Proyecto</h1>
                  <div class="info">
                      <strong>Información:</strong> Esta página se actualiza automáticamente con cada release del proyecto.
                  </div>
                  <a href="./coverage/" class="report-link">Reporte de Cobertura de Tests</a>
                  <a href="https://github.com/UPT-FAING-EPIS/examen-si889-2025-ii-u2-David-Anampa" class="report-link">Repositorio en GitHub</a>
                  <a href="https://github.com/UPT-FAING-EPIS/examen-si889-2025-ii-u2-David-Anampa/releases" class="report-link">Releases</a>
              </div>
          </body>
          </html>
          EOF
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: public
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2